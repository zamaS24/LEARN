<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <style>
        html {
            outline: 3px solid black; 
        }
        body{
            background-color: bisque;
            width: 1000px; 
            height: 1000px;
            margin: auto; 
           
        }

        svg{
            margin: auto;
            padding-bottom: 5px;
            /* outline: 3px solid red; */
        }

        button {
            background-color: #3498db; /* Background color */
            color: #fff; /* Text color */
            border: none; /* No border */
            padding: 10px 20px; /* Padding */
            cursor: pointer; /* Cursor style */
            border-radius: 5px; /* Rounded corners */
            font-size: 16px; /* Text size */
            
            display: block;
        }

        /* Style the button on hover */
        button:hover {
            background-color: #2980b9; /* Darker background color */
        }

    </style>

    <script src="d3.v7.js"></script>
</head>
<body>
    <h1>Visualization de tri par permutation </h1>
    <script >
        const N = 10;
        let dataArray = Array.from({
            length: N
        }, () => Math.floor(Math.random() * N) + 1);
        let width = 500
        let height = 500
        let padding = 20

        let svg = d3.select("body")
            .append("svg")
            .attr("width", width)
            .attr("height", height)

        

        let x = d3.scaleBand()
            .range([padding, width - padding])
            .domain(dataArray.map((d, i) => i))
            .padding(0.05);

        const y = d3.scaleLinear()
            .range([height - padding, padding])
            .domain([0, d3.max(dataArray)]);

        svg.selectAll("rect")
            .data(dataArray)
            .enter()
            .append("rect")
            .attr("x", (d, i) => x(i))
            .attr("y", d => y(d))
            .attr("width", x.bandwidth())
            .attr("height", d => height - padding - y(d))
            .attr("fill", "#FF5555");

        let currentIndex = 0;
        let swapped = false;

        function Permutationsort() {
            if (currentIndex < dataArray.length - 1) {
                if (dataArray[currentIndex] > dataArray[currentIndex + 1]) {
                    // Permutation
                    const temp = dataArray[currentIndex];
                    dataArray[currentIndex] = dataArray[currentIndex + 1];
                    dataArray[currentIndex + 1] = temp;
                    swapped = true;
                }
                currentIndex++;

                if (currentIndex === dataArray.length - 1) {
                    if (!swapped) {
                        clearInterval(interval);
                    }
                    currentIndex = 0;
                    swapped = false;
                }

                // selectionner les bars
                let selectedBars = svg.selectAll("rect")
                    .filter(function() {
                        return parseFloat(d3.select(this).attr("x")) === currentIndex || currentIndex + 1 ;
                    });

                console.log(selectedBars)

                // array destructuring
                let [bar1, bar2] = selectedBars

                bar1
                    .transition()
                        .style('fill', '#3498db')
                        .duration(500)
                        .attr("y", d=> y(d))

                bar2
                    .transition()
                        .style('fill', '#3498db')
                        .duration(500)
                        .attr("y", d=> y(d))
                    


                

                    // svg.selectAll("rect")
                    //     .data(dataArray)
                    //     .transition()
                    //         .style('fill', '#3498db')
                    //         .duration(500)

                    //         .attr("y", d => y(d))
                    //         .attr("height", d => height - padding - y(d));

            }
        }
        function start () {
            console.log('Starting of the sort process')
            setInterval(() => {
                Permutationsort();
            }, 3000);
        }
        
        let xAxis = d3.axisBottom(x).ticks(10);
        let yAxis = d3.axisLeft(y).ticks(10);
        svg.append("g")
            .attr("transform", "translate(0, " + (height - padding) + ")")
            .call(xAxis);
        svg.append("g")
            .attr("transform", "translate(" + padding + ", 0)")
            .call(yAxis);
    </script>



    
    <button onclick="start()">Sort the elements</button>
    
</body>
</html>







